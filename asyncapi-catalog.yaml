asyncapi: '2.4.0'
id: 'finetech:sales:product'
info:
  title: Finetech Product API
  version: '1.0.0'
  description: |
    The Product API publishes events when ever changes occurs to catalogs, products or prices.
  contact:
    email: api@finetech.dk
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0

servers:
  test-broker:
    url: test-broker.finetech.dk:8092
    protocol: kafka
    protocolVersion: 2.6.0
    description: Finetech Test Broker

defaultContentType: application/json

channels:
  sales.product.catalog:
    description: The channel on which ProductCatalogEvents are published.
    subscribe:
      operationId: ProductCatalogEvent
      bindings:
        kafka:
          clientId:
            type: string
          groupId:
            type: string
      message:
        $ref: '#/components/messages/ProductCatalogEvent'

  sales.product.price:
    description: The channel on which ProductPriceEvents events are published.
    publish:
      operationId: ProductPriceEvent
      bindings:
        kafka:
          clientId:
            type: string
          groupId:
            type: string
      message:
        $ref: '#/components/messages/ProductPriceEvent'

components:
  messages:
    ProductCatalogEvent:
      name: ProductCatalogEvent
      contentType: application/json
      payload:
        $ref: "#/components/schemas/ProductCatalogData"
    ProductPriceEvent:
      name: ProductPriceEvent
      contentType: application/json
      payload:
        $ref: "#/components/schemas/ProductPriceData"
  schemas:
#    ProductCatalogEvent:      
#      type: object
#      allOf:
#        - $ref: 'https://raw.githubusercontent.com/cloudevents/spec/v1.0.1/spec.json'
#        - $ref: '#/components/schemas/ProductCatalogData'
    ProductCatalogData:
      type: object
      properties:
        data: 
          $ref: '#/components/schemas/ProductCatalog'
    ProductCatalog:
      type: object
      properties:
        name: 
          type: string
        products:
          type: array
          items:
            $ref: '#/components/schemas/Product'

    Product:
      type: object
      properties:
        catalog_name:
          type: string
        number:
          type: string
        display_name:
          type: string
        quote_criteria:
          type: array
          items:
            $ref: '#/components/schemas/Criterion'
    Criterion:
      type: object
      properties:
        name:
          type: string
        display_name:
          type: string
        value:
          type: string
        type:
          type: string
          enum:
            - BOOLEAN
            - INTEGER
            - DECIMAL
            - DATE
            - STRING
            - EMAIL
        allow_values:
          type: array
          items:
            $ref: '#/components/schemas/CriterionAllowValue'
        allow_mulitiselect:
          type: boolean
        allow_limit:
          type: object
          properties:
            min_value:
              type: string
            min_inclusive:
              type: boolean
            max_value:
              type: string
            max_inclusive:
              type: string
    CriterionAllowValue:
      type: object
      properties:
        key:
          type: string
        display_value:
          type: string
        selected:
          type: boolean        
#    ProductPriceEvent:
#      type: object
#      allOf:
#        - $ref: 'https://raw.githubusercontent.com/cloudevents/spec/v1.0.1/spec.json'
#        - $ref: '#/components/schemas/ProductPriceData'
    ProductPriceData:
      type: object
      properties:
        data: 
          $ref: '#/components/schemas/ProductPrice'
    ProductPrice:
      type: object
      properties:
        catalog:
          $ref: '#/components/schemas/ProductCatalogName'
        product: 
          $ref: '#/components/schemas/ProductName'
        price: 
          $ref: '#/components/schemas/ProductPriceAmountCurrency'
    ProductCatalogName:
      type: object
      properties: 
        name:
          type: string
    ProductName:
      type: object
      properties: 
        name:
          type: string
    ProductPriceAmountCurrency:
      properties: 
        amount:
          type: number
        currency:
          type: string

